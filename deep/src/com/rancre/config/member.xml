<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">
			
<mapper namespace="member">

	<!-- MemberController.checkMember() -->
    <select id="checkMember" parameterType="java.util.HashMap" resultType="int">
		SELECT count(*) FROM rac_member 
		<if test="mode == 1" >
			WHERE racMemberEmail=#{memberParam}
		</if>
		<if test="mode == 3">
			WHERE racMemberEmail=#{memberParam}
		</if>
	</select>
		
	<!-- MemberController.loginMember() -->
    <select id="getMemberByMemberMail" parameterType="java.util.HashMap" resultType="com.rancre.model.domain.Member">
		SELECT * FROM rac_member WHERE racMemberEmail=#{memberEmail} AND racMemberPassword=#{memberPassword} AND racMemberStatus=2
	</select>
	
	<select id="getMemberUid" parameterType="int" resultType="com.rancre.model.domain.MemberUid">
		SELECT * FROM rac_member_uid WHERE racMemberNo=#{inputMemberNo}
	</select>
	
	<!-- MemberController.joinMember() -->
    <select id="addMember" parameterType="java.util.HashMap" resultType="int">
		INSERT INTO rac_member(racMemberStatus, racMemberCreateDate, racMemberEmail, racMemberPassword)
		VALUES(#{memberStatus}, #{inputCurrentDate}, #{memberEmail}, #{memberPassword})
	</select>

    <select id="addMemberUid" parameterType="java.util.HashMap" resultType="int">
		INSERT INTO rac_member_uid(racMemberNo, racMemberUid)
		VALUES((SELECT racMemberNo FROM rac_member WHERE racMemberEmail=#{memberEmail}), #{memberUid})
	</select>	
	
    <select id="addCompany" parameterType="java.util.HashMap" resultType="int">
		INSERT INTO rac_company(racMemberNo, racCompanyName, racCompanyBusinessNo)
		VALUES((SELECT racMemberNo FROM rac_member WHERE racMemberEmail=#{memberEmail}), #{companyName}, #{businessNo})
	</select>
		
	<select id="checkCompany" parameterType="String" resultType="int">
		SELECT count(*) FROM rac_company WHERE racCompanyBusinessNo=#{inputBusinessNo}
	</select>	
	
	<select id="permitJoin" parameterType="java.util.HashMap" resultType="int">
		UPDATE rac_member SET racMemberStatus=2
		WHERE racMemberNo=(SELECT a.racMemberNo FROM (SELECT * FROM rac_member WHERE racMemberEmail=#{email}) a, (SELECT * FROM rac_member_uid WHERE racMemberUid=#{uid}) b WHERE a.racMemberNo=b.racMemberNo AND a.racMemberStatus=1)
	</select>
			
	<select id="getMemberByJoinPermit" parameterType="java.util.HashMap" resultType="com.rancre.model.domain.Member">
		SELECT a.* 
		FROM (SELECT * FROM rac_member WHERE racMemberEmail=#{memberEmail}) a, (SELECT * FROM rac_member_uid WHERE racMemberUid=#{memberUid}) b
		WHERE a.racMemberNo=b.racMemberNo	
	</select>	
		
	<select id="addMemberAdTarget" parameterType="java.util.HashMap" resultType="int">
		UPDATE rac_company SET racCompanyAdCategory=#{adCategory}, racCompanyTargetAge=#{targetAge}, racCompanyTargetGender=#{targetSex}
		WHERE racMemberNo=(SELECT racMemberNo FROM rac_member_uid WHERE racMemberUid=#{memberUid})
	</select>
	
	<select id="getMemberByMemberUid" parameterType="String" resultType="com.rancre.model.domain.Member">
		SELECT a.* 
		FROM (SELECT * FROM rac_member) a, (SELECT * FROM rac_member_uid WHERE racMemberUid=#{memberUid}) b
		WHERE a.racMemberNo=b.racMemberNo		
	</select>	
	
	<!-- CommonController.setProfile -->
	<select id="setMember" parameterType="java.util.HashMap" resultType="int">
		UPDATE deep_member 
		<if test="mode==1">
			SET deepMemberMajor=#{memberMajor}, deepMemberCareer=#{memberCareer}, deepMemberName=#{memberName}, deepMemberPassword=#{memberPassword}
			WHERE deepMemberNo=#{memberNo}
		</if>
		<if test="mode==2">
			SET deepMemberMajor=#{memberMajor}, deepMemberCareer=#{memberCareer}, deepMemberName=#{memberName}
			WHERE deepMemberNo=#{memberNo}
		</if>
	</select>
	
	<select id="setMemberImg" parameterType="java.util.HashMap" resultType="int">
		UPDATE deep_member SET deepMemberImage=#{uploadNo}
		WHERE deepMemberNo=#{memberNo}
	</select>
	
	<!-- CommonMethod -->
	<select id="getMemberByMemberNo" parameterType="int" resultType="com.rancre.model.domain.Member">
		SELECT * FROM deep_member WHERE deepMemberNo=#{inputMemberNo}
	</select>
	
	<select id="getMemberFavorite" parameterType="int" resultType="com.rancre.model.domain.MemberFavorite">
		SELECT * FROM deep_member_favorite WHERE deepMemberNo=#{inputMemberNo}
	</select>
	
	<select id="getMemberNoByMemberUid" parameterType="String" resultType="int">
		SELECT deepMemberNo FROM deep_member_uid WHERE deepMemberUid=#{inputMemberUid}
	</select>
</mapper>